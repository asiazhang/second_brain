# CSRF攻击与防范

## 什么是CSRF攻击
CSRF全称是Cross-site request forgery(跨站请求伪造)。CSRF是一种利用当前用户的已认证状态，利用此在Web网站执行一些用户不想执行的操作。

## CSRF攻击有啥影响
在成功的CSRF里面，攻击者让受害者无意中执行了某些操作。比如，攻击者可以修改受害者的账户邮箱地址，或者修改账户密码，又或者发起一个资金转账。根据环境的不同，攻击者设置可以获得受害者的全部账户控制权限。如果用户拥有网站的高级管理员权限，你想想🐶…………

## CSRF是如何生效的
要CSRF生效，必须满足三个条件：
1. **有效的攻击操作**。攻击者来攻击系统的理由就是这个操作。这个可能是一个权限操作（比如修改其他用户权限），或者跟用户数据相关的操作（比如修改用户自身密码）。
2. **必须使用基于Cookie的Session机制**。由于此种攻击必须要发起一个或者多个HTTP请求，如果应用程序仅依赖基于Cookie的Session认证才会跟攻击者可乘之机。系统不能使用其他方式来验证用户请求是否有效。
3. **没有不可预期的参数**。请求必须不包含攻击者无法猜测的参数。以修改用户账号密码为例，如果请求中需要附带旧密码，这种情况攻击者就无法攻击成功。

从CSRF的生效条件来看，就是利用了Web系统中session可以跨域，客户端对API的鉴权太过于简单导致的。系统API在设计的时候，最开始就需要考虑：
1. 如何证明用户是有效的
2. 即使用户有效，用户的参数也必须是有效，并且没有被篡改的
3. 重要敏感API引入二次验证机制。

计算机中有一条安全原则：**永远不要相信用户输入。任何输入数据在证明其无害之前，都是有害的。**

## 如何防范CSRF攻击
